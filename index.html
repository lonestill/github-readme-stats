<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Readme Stats - Card Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      min-height: 100vh;
    }
    .card-preview {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .code-block {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      overflow-x: auto;
      font-size: 14px;
    }
    .theme-select {
      background: #1e293b;
      color: #e2e8f0;
      border: 1px solid #334155;
      border-radius: 6px;
      padding: 8px 12px;
    }
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #10b981;
      color: white;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
  </style>
</head>
<body class="text-slate-200">
  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold mb-2 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
        GitHub Readme Stats
      </h1>
      <p class="text-slate-400">Generate beautiful stats cards for your GitHub profile</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- Configuration Panel -->
      <div class="space-y-6">
        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold text-blue-400">Card Configuration</h2>
            <div class="flex gap-2">
              <button onclick="saveConfig()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm">
                üíæ Save
              </button>
              <button onclick="loadConfig()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                üìÇ Load
              </button>
              <button onclick="exportConfig()" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded text-sm">
                üì§ Export
              </button>
              <button onclick="importConfig()" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-1 rounded text-sm">
                üì• Import
              </button>
            </div>
          </div>
          
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-2">GitHub Username</label>
              <input 
                type="text" 
                id="username" 
                value="lonestill"
                class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                placeholder="Enter your GitHub username">
            </div>

            <div>
              <label class="block text-sm font-medium mb-2">Card Type</label>
              <select id="cardType" class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none">
                <option value="stats">Stats Card</option>
                <option value="top-langs">Top Languages</option>
                <option value="pin">Repository Pin</option>
                <option value="gist">Gist Card</option>
                <option value="wakatime">WakaTime Stats</option>
                <option value="trophy">Trophy Card</option>
                <option value="streak">Streak Card</option>
                <option value="activity-graph">Activity Graph</option>
              </select>
            </div>

            <!-- Presets -->
            <div class="bg-slate-900 rounded p-4 border border-slate-700">
              <label class="block text-sm font-medium mb-2">Quick Presets</label>
              <div class="flex flex-wrap gap-2">
                <button onclick="applyPreset('minimal')" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                  Minimal
                </button>
                <button onclick="applyPreset('detailed')" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                  Detailed
                </button>
                <button onclick="applyPreset('dark')" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                  Dark Theme
                </button>
                <button onclick="applyPreset('colorful')" class="bg-slate-700 hover:bg-slate-600 text-white px-3 py-1 rounded text-xs">
                  Colorful
                </button>
              </div>
            </div>

            <!-- Stats Card Options -->
            <div id="statsOptions" class="space-y-4">
              <div>
                <label class="block text-sm font-medium mb-2">Theme</label>
                <select id="theme" class="theme-select w-full">
                  <option value="default">Default</option>
                  <option value="dark">Dark</option>
                  <option value="radical">Radical</option>
                  <option value="merko">Merko</option>
                  <option value="gruvbox">Gruvbox</option>
                  <option value="tokyonight">Tokyo Night</option>
                  <option value="onedark">One Dark</option>
                  <option value="cobalt">Cobalt</option>
                  <option value="synthwave">Synthwave</option>
                  <option value="highcontrast">High Contrast</option>
                  <option value="dracula">Dracula</option>
                  <option value="transparent">Transparent</option>
                  <option value="prussian">Prussian</option>
                  <option value="monokai">Monokai</option>
                  <option value="vue">Vue</option>
                  <option value="vue-dark">Vue Dark</option>
                  <option value="shades-of-purple">Shades of Purple</option>
                  <option value="nightowl">Night Owl</option>
                  <option value="buefy">Buefy</option>
                  <option value="blue-green">Blue Green</option>
                  <option value="algolia">Algolia</option>
                  <option value="great-gatsby">Great Gatsby</option>
                  <option value="darcula">Darcula</option>
                  <option value="bear">Bear</option>
                  <option value="solarized-dark">Solarized Dark</option>
                  <option value="solarized-light">Solarized Light</option>
                  <option value="chartreuse-dark">Chartreuse Dark</option>
                  <option value="nord">Nord</option>
                  <option value="gotham">Gotham</option>
                  <option value="material-palenight">Material Palenight</option>
                  <option value="graywhite">Gray White</option>
                  <option value="vision-friendly-dark">Vision Friendly Dark</option>
                  <option value="ayu-mirage">Ayu Mirage</option>
                  <option value="midnight-purple">Midnight Purple</option>
                  <option value="calm">Calm</option>
                  <option value="omni">Omni</option>
                  <option value="react">React</option>
                  <option value="jolly">Jolly</option>
                  <option value="maroongold">Maroon Gold</option>
                  <option value="yeblu">Yeblu</option>
                  <option value="blueberry">Blueberry</option>
                  <option value="slateorange">Slate Orange</option>
                  <option value="kacho_ga">Kacho Ga</option>
                  <option value="outrun">Outrun</option>
                  <option value="ocean_dark">Ocean Dark</option>
                  <option value="city_lights">City Lights</option>
                  <option value="github_dark">GitHub Dark</option>
                  <option value="github_dark_dimmed">GitHub Dark Dimmed</option>
                  <option value="discord_old_blurple">Discord Old Blurple</option>
                  <option value="aura_dark">Aura Dark</option>
                  <option value="panda">Panda</option>
                  <option value="noctis_minimus">Noctis Minimus</option>
                  <option value="cobalt2">Cobalt2</option>
                  <option value="swift">Swift</option>
                  <option value="aura">Aura</option>
                  <option value="apprentice">Apprentice</option>
                  <option value="moltack">Moltack</option>
                  <option value="codeSTACKr">CodeSTACKr</option>
                  <option value="rose_pine">Rose Pine</option>
                  <option value="catppuccin_latte">Catppuccin Latte</option>
                  <option value="catppuccin_mocha">Catppuccin Mocha</option>
                  <option value="date_night">Date Night</option>
                  <option value="one_dark_pro">One Dark Pro</option>
                  <option value="rose">Rose</option>
                  <option value="holi">Holi</option>
                  <option value="neon">Neon</option>
                  <option value="blue_navy">Blue Navy</option>
                  <option value="calm_pink">Calm Pink</option>
                  <option value="ambient_gradient">Ambient Gradient</option>
                </select>
              </div>

              <div class="grid grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium mb-2">Show Icons</label>
                  <input type="checkbox" id="showIcons" class="w-5 h-5">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Hide Border</label>
                  <input type="checkbox" id="hideBorder" class="w-5 h-5">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Hide Rank</label>
                  <input type="checkbox" id="hideRank" class="w-5 h-5">
                </div>
                <div>
                  <label class="block text-sm font-medium mb-2">Include All Commits</label>
                  <input type="checkbox" id="includeAllCommits" class="w-5 h-5">
                </div>
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Hide Stats (comma-separated)</label>
                <input 
                  type="text" 
                  id="hideStats"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="stars,commits,prs,issues,contribs">
              </div>

              <div>
                <label class="block text-sm font-medium mb-2">Custom Title</label>
                <input 
                  type="text" 
                  id="customTitle"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="Custom card title">
              </div>
            </div>

            <!-- Top Langs Options -->
            <div id="topLangsOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">Theme</label>
                <select id="topLangsTheme" class="theme-select w-full">
                  <option value="tokyonight">Tokyo Night</option>
                  <option value="dark">Dark</option>
                  <option value="radical">Radical</option>
                  <option value="dracula">Dracula</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Layout</label>
                <select id="layout" class="theme-select w-full">
                  <option value="normal">Normal</option>
                  <option value="compact">Compact</option>
                  <option value="donut">Donut</option>
                  <option value="donut-vertical">Donut Vertical</option>
                  <option value="pie">Pie</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Languages Count (1-20)</label>
                <input 
                  type="number" 
                  id="langsCount"
                  min="1"
                  max="20"
                  value="5"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none">
              </div>
            </div>

            <!-- Pin Options -->
            <div id="pinOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">Repository Name</label>
                <input 
                  type="text" 
                  id="repoName"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="repository-name">
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Show Owner</label>
                <input type="checkbox" id="showOwner" class="w-5 h-5">
              </div>
            </div>

            <!-- Gist Options -->
            <div id="gistOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">Gist ID</label>
                <input 
                  type="text" 
                  id="gistId"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="bbfce31e0217a3689c8d961a356cb10d">
              </div>
            </div>

            <!-- WakaTime Options -->
            <div id="wakatimeOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">WakaTime Username</label>
                <input 
                  type="text" 
                  id="wakatimeUsername"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="wakatime-username">
              </div>
            </div>

            <!-- Trophy Options -->
            <div id="trophyOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">Theme</label>
                <select id="trophyTheme" class="theme-select w-full">
                  <option value="tokyonight">Tokyo Night</option>
                  <option value="dark">Dark</option>
                  <option value="radical">Radical</option>
                  <option value="dracula">Dracula</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Columns</label>
                <input 
                  type="number" 
                  id="trophyColumns"
                  min="1"
                  max="10"
                  value="7"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none">
              </div>
            </div>

            <!-- Streak Options -->
            <div id="streakOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">Theme</label>
                <select id="streakTheme" class="theme-select w-full">
                  <option value="tokyonight">Tokyo Night</option>
                  <option value="dark">Dark</option>
                  <option value="radical">Radical</option>
                  <option value="dracula">Dracula</option>
                </select>
              </div>
            </div>

            <!-- Activity Graph Options -->
            <div id="activityGraphOptions" class="space-y-4 hidden">
              <div>
                <label class="block text-sm font-medium mb-2">Theme</label>
                <select id="activityGraphTheme" class="theme-select w-full">
                  <option value="tokyonight">Tokyo Night</option>
                  <option value="dark">Dark</option>
                  <option value="radical">Radical</option>
                  <option value="dracula">Dracula</option>
                </select>
              </div>
              <div>
                <label class="block text-sm font-medium mb-2">Year (optional)</label>
                <input 
                  type="number" 
                  id="activityYear"
                  min="2008"
                  max="2030"
                  class="w-full bg-slate-900 border border-slate-600 rounded px-4 py-2 text-white focus:ring-2 focus:ring-blue-500 outline-none"
                  placeholder="Leave empty for current year">
              </div>
            </div>

            <button 
              onclick="generateCard()"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors">
              Generate Card
            </button>
          </div>
        </div>

        <!-- Saved Configurations -->
        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
          <h3 class="text-xl font-bold mb-4 text-purple-400">Saved Configurations</h3>
          <div id="savedConfigs" class="space-y-2">
            <p class="text-slate-400 text-sm">No saved configurations yet</p>
          </div>
        </div>
      </div>

      <!-- Preview Panel -->
      <div class="space-y-6">
        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
          <h2 class="text-2xl font-bold mb-4 text-purple-400">Preview</h2>
          <div id="preview" class="card-preview min-h-[200px] flex items-center justify-center">
            <p class="text-slate-500">Configure your card and click "Generate Card" to see preview</p>
          </div>
        </div>

        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
          <h2 class="text-2xl font-bold mb-4 text-green-400">Markdown Code</h2>
          <div class="code-block" id="markdownCode">
            <code>Configure your card to generate markdown code</code>
          </div>
          <button 
            onclick="copyMarkdown()"
            class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors">
            Copy Markdown
          </button>
        </div>

        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
          <h2 class="text-2xl font-bold mb-4 text-yellow-400">Direct URL</h2>
          <div class="code-block" id="directUrl">
            <code>Configure your card to generate URL</code>
          </div>
          <button 
            onclick="copyUrl()"
            class="mt-4 w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded transition-colors">
            Copy URL
          </button>
        </div>

        <!-- Full README Template -->
        <div class="bg-slate-800 rounded-lg p-6 border border-slate-700">
          <h2 class="text-2xl font-bold mb-4 text-pink-400">Full README Template</h2>
          <div class="code-block" id="fullReadme" style="max-height: 300px; overflow-y: auto;">
            <code>Generate cards to see full README template</code>
          </div>
          <button 
            onclick="copyFullReadme()"
            class="mt-4 w-full bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded transition-colors">
            Copy Full README
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const baseUrl = window.location.origin;
    let savedConfigs = JSON.parse(localStorage.getItem('github-readme-stats-configs') || '[]');
    let currentConfig = null;

    // Load saved configs on page load
    window.addEventListener('DOMContentLoaded', () => {
      loadSavedConfigs();
      // Auto-generate on load if username exists
      const username = document.getElementById('username').value;
      if (username) {
        setTimeout(() => generateCard(), 500);
      }
    });

    function getCardType() {
      return document.getElementById('cardType').value;
    }

    function getUsername() {
      return document.getElementById('username').value || 'lonestill';
    }

    function getAllConfig() {
      const cardType = getCardType();
      const config = {
        username: getUsername(),
        cardType: cardType,
      };

      if (cardType === 'stats') {
        config.theme = document.getElementById('theme').value;
        config.showIcons = document.getElementById('showIcons').checked;
        config.hideBorder = document.getElementById('hideBorder').checked;
        config.hideRank = document.getElementById('hideRank').checked;
        config.includeAllCommits = document.getElementById('includeAllCommits').checked;
        config.hideStats = document.getElementById('hideStats').value.trim();
        config.customTitle = document.getElementById('customTitle').value.trim();
      } else if (cardType === 'top-langs') {
        config.theme = document.getElementById('topLangsTheme')?.value || 'tokyonight';
        config.layout = document.getElementById('layout').value;
        config.langsCount = document.getElementById('langsCount').value;
      } else if (cardType === 'pin') {
        config.repoName = document.getElementById('repoName').value.trim();
        config.showOwner = document.getElementById('showOwner').checked;
      } else if (cardType === 'gist') {
        config.gistId = document.getElementById('gistId').value.trim();
      } else if (cardType === 'wakatime') {
        config.wakatimeUsername = document.getElementById('wakatimeUsername').value.trim();
      } else if (cardType === 'trophy') {
        config.theme = document.getElementById('trophyTheme')?.value || 'tokyonight';
        config.columns = document.getElementById('trophyColumns')?.value || 7;
      }

      return config;
    }

    function setAllConfig(config) {
      document.getElementById('username').value = config.username || 'lonestill';
      document.getElementById('cardType').value = config.cardType || 'stats';
      
      // Trigger card type change to show/hide options
      document.getElementById('cardType').dispatchEvent(new Event('change'));

      if (config.cardType === 'stats') {
        if (config.theme) document.getElementById('theme').value = config.theme;
        if (config.showIcons !== undefined) document.getElementById('showIcons').checked = config.showIcons;
        if (config.hideBorder !== undefined) document.getElementById('hideBorder').checked = config.hideBorder;
        if (config.hideRank !== undefined) document.getElementById('hideRank').checked = config.hideRank;
        if (config.includeAllCommits !== undefined) document.getElementById('includeAllCommits').checked = config.includeAllCommits;
        if (config.hideStats) document.getElementById('hideStats').value = config.hideStats;
        if (config.customTitle) document.getElementById('customTitle').value = config.customTitle;
      } else if (config.cardType === 'top-langs') {
        if (config.theme && document.getElementById('topLangsTheme')) document.getElementById('topLangsTheme').value = config.theme;
        if (config.layout) document.getElementById('layout').value = config.layout;
        if (config.langsCount) document.getElementById('langsCount').value = config.langsCount;
      } else if (config.cardType === 'pin') {
        if (config.repoName) document.getElementById('repoName').value = config.repoName;
        if (config.showOwner !== undefined) document.getElementById('showOwner').checked = config.showOwner;
      } else if (config.cardType === 'gist') {
        if (config.gistId) document.getElementById('gistId').value = config.gistId;
      } else if (config.cardType === 'wakatime') {
        if (config.wakatimeUsername) document.getElementById('wakatimeUsername').value = config.wakatimeUsername;
      } else if (config.cardType === 'trophy') {
        if (config.theme && document.getElementById('trophyTheme')) document.getElementById('trophyTheme').value = config.theme;
        if (config.columns && document.getElementById('trophyColumns')) document.getElementById('trophyColumns').value = config.columns;
      }
    }

    function buildUrl() {
      const cardType = getCardType();
      const username = getUsername();
      const params = new URLSearchParams();
      
      params.append('username', username);

      if (cardType === 'stats') {
        const theme = document.getElementById('theme').value;
        if (theme && theme !== 'default') params.append('theme', theme);
        if (document.getElementById('showIcons').checked) params.append('show_icons', 'true');
        if (document.getElementById('hideBorder').checked) params.append('hide_border', 'true');
        if (document.getElementById('hideRank').checked) params.append('hide_rank', 'true');
        if (document.getElementById('includeAllCommits').checked) params.append('include_all_commits', 'true');
        
        const hideStats = document.getElementById('hideStats').value.trim();
        if (hideStats) params.append('hide', hideStats);
        
        const customTitle = document.getElementById('customTitle').value.trim();
        if (customTitle) params.append('custom_title', customTitle);

        return `${baseUrl}/api?${params.toString()}`;
      } else if (cardType === 'top-langs') {
        const theme = document.getElementById('topLangsTheme')?.value || 'tokyonight';
        const layout = document.getElementById('layout').value;
        const langsCount = document.getElementById('langsCount').value;
        if (theme && theme !== 'default') params.append('theme', theme);
        if (layout && layout !== 'normal') params.append('layout', layout);
        if (langsCount) params.append('langs_count', langsCount);
        return `${baseUrl}/api/top-langs?${params.toString()}`;
      } else if (cardType === 'pin') {
        const repoName = document.getElementById('repoName').value.trim();
        if (!repoName) {
          alert('Please enter repository name');
          return null;
        }
        params.append('repo', repoName);
        if (document.getElementById('showOwner').checked) params.append('show_owner', 'true');
        return `${baseUrl}/api/pin?${params.toString()}`;
      } else if (cardType === 'gist') {
        const gistId = document.getElementById('gistId').value.trim();
        if (!gistId) {
          alert('Please enter Gist ID');
          return null;
        }
        return `${baseUrl}/api/gist?id=${gistId}`;
      } else if (cardType === 'wakatime') {
        const wakatimeUsername = document.getElementById('wakatimeUsername').value.trim();
        if (!wakatimeUsername) {
          alert('Please enter WakaTime username');
          return null;
        }
        return `${baseUrl}/api/wakatime?username=${wakatimeUsername}`;
      } else if (cardType === 'trophy') {
        const theme = document.getElementById('trophyTheme')?.value || 'tokyonight';
        const columns = document.getElementById('trophyColumns')?.value || 7;
        if (theme && theme !== 'default') params.append('theme', theme);
        params.append('column', columns);
        params.append('margin_w', '15');
        params.append('margin_h', '15');
        return `${baseUrl}/api/trophy?${params.toString()}`;
      } else if (cardType === 'streak') {
        const theme = document.getElementById('streakTheme')?.value || 'tokyonight';
        if (theme && theme !== 'default') params.append('theme', theme);
        return `${baseUrl}/api/streak?${params.toString()}`;
      } else if (cardType === 'activity-graph') {
        const theme = document.getElementById('activityGraphTheme')?.value || 'tokyonight';
        const year = document.getElementById('activityYear')?.value;
        if (theme && theme !== 'default') params.append('theme', theme);
        if (year) params.append('year', year);
        return `${baseUrl}/api/activity-graph?${params.toString()}`;
      }
      return null;
    }

    function generateCard() {
      const url = buildUrl();
      if (!url) return;

      currentConfig = getAllConfig();

      // Update preview
      const previewDiv = document.getElementById('preview');
      previewDiv.innerHTML = `<img src="${url}" alt="GitHub Stats Card" style="max-width: 100%; height: auto;" onerror="this.parentElement.innerHTML='<p class=\'text-red-500\'>Error loading card. Please check your configuration.</p>'">`;

      // Update markdown code
      const markdownCode = `[![GitHub Stats](${url})](https://github.com/${getUsername()})`;
      document.getElementById('markdownCode').innerHTML = `<code>${escapeHtml(markdownCode)}</code>`;

      // Update direct URL
      document.getElementById('directUrl').innerHTML = `<code>${escapeHtml(url)}</code>`;

      // Update full README template
      updateFullReadme();
    }

    function updateFullReadme() {
      const username = getUsername();
      const statsUrl = buildUrl();
      if (!statsUrl) return;

      const readme = `# ${username}

<div align="center">
  <img src="https://avatars.githubusercontent.com/u/USER_ID?v=4" width="150" style="border-radius: 50%;" alt="Avatar"/>
  
  <h1>${username}</h1>
  
  <p><i>Your bio here</i></p>
</div>

---

## üìä GitHub Stats

<div align="center">
  
  <img height="165em" src="${statsUrl}" alt="GitHub Stats"/>
  
</div>

---

## üèÜ Trophies

<div align="center">
  <img src="${baseUrl}/api/trophy?username=${username}&theme=tokyonight&hide_border=true&column=7&margin_w=15&margin_h=15" alt="Trophies" />
</div>

---

## üõ†Ô∏è Tech Stack

<div align="center">
  
  ![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=flat-square&logo=javascript&logoColor=black)
  ![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=flat-square&logo=typescript&logoColor=white)
  ![Node.js](https://img.shields.io/badge/Node.js-339933?style=flat-square&logo=nodedotjs&logoColor=white)
  
</div>

---

<div align="center">
  <img src="https://komarev.com/ghpvc/?username=${username}&label=Profile%20Views&color=0ea5e9&style=flat-square" alt="Profile Views" />
</div>`;

      document.getElementById('fullReadme').innerHTML = `<code>${escapeHtml(readme)}</code>`;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => toast.remove(), 300);
      }, 2000);
    }

    function copyMarkdown() {
      const code = document.getElementById('markdownCode').querySelector('code').textContent;
      navigator.clipboard.writeText(code).then(() => {
        showToast('Markdown code copied!');
      });
    }

    function copyUrl() {
      const code = document.getElementById('directUrl').querySelector('code').textContent;
      navigator.clipboard.writeText(code).then(() => {
        showToast('URL copied!');
      });
    }

    function copyFullReadme() {
      const code = document.getElementById('fullReadme').querySelector('code').textContent;
      navigator.clipboard.writeText(code).then(() => {
        showToast('Full README copied!');
      });
    }

    function saveConfig() {
      const config = getAllConfig();
      const name = prompt('Enter a name for this configuration:');
      if (!name) return;

      const savedConfig = {
        name: name,
        config: config,
        timestamp: new Date().toISOString()
      };

      savedConfigs.push(savedConfig);
      localStorage.setItem('github-readme-stats-configs', JSON.stringify(savedConfigs));
      loadSavedConfigs();
      showToast('Configuration saved!');
    }

    function loadConfig() {
      if (savedConfigs.length === 0) {
        alert('No saved configurations');
        return;
      }

      const names = savedConfigs.map((c, i) => `${i + 1}. ${c.name}`).join('\n');
      const choice = prompt(`Choose configuration (enter number):\n${names}`);
      const index = parseInt(choice) - 1;

      if (index >= 0 && index < savedConfigs.length) {
        setAllConfig(savedConfigs[index].config);
        generateCard();
        showToast('Configuration loaded!');
      }
    }

    function exportConfig() {
      const config = getAllConfig();
      const dataStr = JSON.stringify(config, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `github-readme-stats-config-${Date.now()}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showToast('Configuration exported!');
    }

    function importConfig() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'application/json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const config = JSON.parse(event.target.result);
            setAllConfig(config);
            generateCard();
            showToast('Configuration imported!');
          } catch (error) {
            alert('Invalid configuration file');
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function loadSavedConfigs() {
      const container = document.getElementById('savedConfigs');
      if (savedConfigs.length === 0) {
        container.innerHTML = '<p class="text-slate-400 text-sm">No saved configurations yet</p>';
        return;
      }

      container.innerHTML = savedConfigs.map((cfg, index) => `
        <div class="bg-slate-900 rounded p-3 flex justify-between items-center">
          <div>
            <p class="text-white font-medium">${cfg.name}</p>
            <p class="text-slate-400 text-xs">${new Date(cfg.timestamp).toLocaleDateString()}</p>
          </div>
          <div class="flex gap-2">
            <button onclick="loadConfigByIndex(${index})" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs">
              Load
            </button>
            <button onclick="deleteConfig(${index})" class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded text-xs">
              Delete
            </button>
          </div>
        </div>
      `).join('');
    }

    function loadConfigByIndex(index) {
      if (index >= 0 && index < savedConfigs.length) {
        setAllConfig(savedConfigs[index].config);
        generateCard();
        showToast('Configuration loaded!');
      }
    }

    function deleteConfig(index) {
      if (confirm('Delete this configuration?')) {
        savedConfigs.splice(index, 1);
        localStorage.setItem('github-readme-stats-configs', JSON.stringify(savedConfigs));
        loadSavedConfigs();
        showToast('Configuration deleted!');
      }
    }

    function applyPreset(preset) {
      const username = getUsername();
      
      if (preset === 'minimal') {
        document.getElementById('cardType').value = 'stats';
        document.getElementById('cardType').dispatchEvent(new Event('change'));
        document.getElementById('theme').value = 'default';
        document.getElementById('showIcons').checked = false;
        document.getElementById('hideBorder').checked = true;
        document.getElementById('hideRank').checked = false;
        document.getElementById('includeAllCommits').checked = false;
        document.getElementById('hideStats').value = '';
        document.getElementById('customTitle').value = '';
      } else if (preset === 'detailed') {
        document.getElementById('cardType').value = 'stats';
        document.getElementById('cardType').dispatchEvent(new Event('change'));
        document.getElementById('theme').value = 'tokyonight';
        document.getElementById('showIcons').checked = true;
        document.getElementById('hideBorder').checked = false;
        document.getElementById('hideRank').checked = false;
        document.getElementById('includeAllCommits').checked = true;
        document.getElementById('hideStats').value = '';
        document.getElementById('customTitle').value = '';
      } else if (preset === 'dark') {
        document.getElementById('cardType').value = 'stats';
        document.getElementById('cardType').dispatchEvent(new Event('change'));
        document.getElementById('theme').value = 'dark';
        document.getElementById('showIcons').checked = true;
        document.getElementById('hideBorder').checked = true;
        document.getElementById('hideRank').checked = false;
        document.getElementById('includeAllCommits').checked = false;
        document.getElementById('hideStats').value = '';
        document.getElementById('customTitle').value = '';
      } else if (preset === 'colorful') {
        document.getElementById('cardType').value = 'stats';
        document.getElementById('cardType').dispatchEvent(new Event('change'));
        document.getElementById('theme').value = 'radical';
        document.getElementById('showIcons').checked = true;
        document.getElementById('hideBorder').checked = false;
        document.getElementById('hideRank').checked = false;
        document.getElementById('includeAllCommits').checked = false;
        document.getElementById('hideStats').value = '';
        document.getElementById('customTitle').value = '';
      }
      
      generateCard();
    }

    // Show/hide options based on card type
    document.getElementById('cardType').addEventListener('change', function() {
      const cardType = this.value;
      document.getElementById('statsOptions').classList.toggle('hidden', cardType !== 'stats');
      document.getElementById('topLangsOptions').classList.toggle('hidden', cardType !== 'top-langs');
      document.getElementById('pinOptions').classList.toggle('hidden', cardType !== 'pin');
      document.getElementById('gistOptions').classList.toggle('hidden', cardType !== 'gist');
      document.getElementById('wakatimeOptions').classList.toggle('hidden', cardType !== 'wakatime');
      document.getElementById('trophyOptions').classList.toggle('hidden', cardType !== 'trophy');
      document.getElementById('streakOptions').classList.toggle('hidden', cardType !== 'streak');
      document.getElementById('activityGraphOptions').classList.toggle('hidden', cardType !== 'activity-graph');
    });

    // Auto-generate on username change with debounce
    let generateTimeout;
    document.getElementById('username').addEventListener('input', function() {
      clearTimeout(generateTimeout);
      generateTimeout = setTimeout(() => {
        if (this.value.trim()) {
          generateCard();
        }
      }, 500);
    });

    // Auto-generate on any option change
    ['theme', 'showIcons', 'hideBorder', 'hideRank', 'includeAllCommits', 'hideStats', 'customTitle',
     'layout', 'langsCount', 'repoName', 'showOwner', 'gistId', 'wakatimeUsername', 
     'topLangsTheme', 'trophyTheme', 'trophyColumns', 'streakTheme', 'activityGraphTheme', 'activityYear'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('change', () => {
          clearTimeout(generateTimeout);
          generateTimeout = setTimeout(generateCard, 300);
        });
        if (el.type === 'checkbox') {
          el.addEventListener('click', () => {
            clearTimeout(generateTimeout);
            generateTimeout = setTimeout(generateCard, 300);
          });
        }
      }
    });
  </script>
</body>
</html>
